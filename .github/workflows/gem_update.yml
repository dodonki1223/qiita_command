name: GemUpdate

# https://docs.github.com/ja/actions/reference/events-that-trigger-workflows#scheduled-events
# æ³¨æ„ï¼šãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã®ç›´è¿‘ã®ã‚³ãƒŸãƒƒãƒˆã§ã®ã¿ã—ã‹å®Ÿè¡Œã•ã‚Œãªã„
# æ¯æœˆã®ï¼‘æ—¥ã®ï¼—æ™‚ã«gem update ã®ãƒ—ãƒ«ãƒªã‚¯ã‚’ä½œæˆã™ã‚‹
on:
  schedule:
    - cron: '*/15 * * * *'
    # - cron: '0 22 1 * *'

jobs:
  create-gem-update:
    strategy:
      # ã„ãšã‚Œã‹ã®matrixã‚¸ãƒ§ãƒ–ãŒå¤±æ•—ã—ãŸå ´åˆã«GitHubã¯é€²è¡Œä¸­ã®ã‚¸ãƒ§ãƒ–ã‚’ã™ã¹ã¦ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Ruby
        # ref: https://github.com/ruby/setup-ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 2.7
      - name: Install dependencies
        run: bundle install
      - name: Settings Git
        run: |
          git config --global user.email ${{ secrets.MAIL_ADDRESS }}
          git config --global user.name "dodonki1223"
      - name: Create gem update pull request
        # NOTE: hub ã‚³ãƒãƒ³ãƒ‰ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¥ã£ã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ãã®ã¾ã¾ä½¿ç”¨ã™ã‚‹
        #       https://github.com/github/hub#github-actions
        run: |
          git checkout -b gem_update
          bundle update
          git add .
          git commit -m ':wrench: Gem Update'
          git push origin gem_update
          hub pull-request -b master -m 'ğŸ”§ Gem Update'
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Github Actions notify to Slack
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          fields: repo,message,commit,author,action,eventName,ref,workflow,job,took
          mention: 'here'
          if_mention: failure
        env:
          GITHUB_TOKEN: ${{ github.token }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        if: always()

